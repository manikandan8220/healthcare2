{% extends "base.html" %}
{% load static %}
{% block content %}

<style>
/* Page Title */
.page-title {
    font-size: 28px;
    font-weight: 800;
    margin-bottom: 25px;
    color: #0f172a;
}

/* Section Wrapper */
.table-section {
    background: #ffffff;
    border-radius: 16px;
    padding: 25px;
    box-shadow: 0 12px 30px rgba(0,0,0,0.08);
    margin-bottom: 30px;
}

/* Table Styling */
.table th {
    background: #66c5e0;
    color: #ffffff;
    font-weight: 700;
    text-align: center;
    vertical-align: middle;
}

.table td {
    text-align: center;
    vertical-align: middle;
    font-weight: 500;
}

.table tbody tr:hover {
    background: #f1f5f9;
}

/* Status Badge */
.status-badge {
    padding: 6px 16px;
    border-radius: 30px;
    font-weight: 700;
    font-size: 14px;
}
.status-critical {
    background: #fee2e2;
    color: #dc2626;
}
.status-stable {
    background: #dcfce7;
    color: #15803d;
}
</style>

<!-- PAGE HEADER -->


<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="page-title">
        {{ patient.name }} – Patient Profile
    </h2>
    <a href="{% url 'patient_list' %}" class="btn btn-outline-secondary">
        ⬅ Back to List
    </a>
</div>


<!-- PATIENT BASIC DETAILS -->


<div class="table-section">
    <h5 class="fw-bold mb-3">Patient Information</h5>

    <table class="table table-bordered mb-0">
        <tr>
            <th>Name</th>
            <td>{{ patient.name }}</td>
            <th>Gender</th>
            <td>{{ patient.gender }}</td>
        </tr>
        <tr>
            <th>Age</th>
            <td>{{ patient.age }}</td>
            <th>Status</th>
            <td>
                {% if records.last.heart_rate and records.last.heart_rate > 100 %}
                    <span class="status-badge status-critical">Critical</span>
                {% else %}
                    <span class="status-badge status-stable">Stable</span>
                {% endif %}
            </td>
        </tr>
        <tr>
            <th>Total Records</th>
            <td colspan="3">{{ records|length }}</td>
        </tr>
    </table>
</div>



<!-- VITALS HISTORY -->


<div class="table-section">
    <h5 class="fw-bold mb-3">Vitals History</h5>

    <div class="table-responsive">
        <table class="table table-striped table-hover mb-0">
            <thead>
                <tr>
                    <th>Heart Rate</th>
                    <th>Blood Pressure</th>
                    <th>Sugar</th>
                    <th>Temperature</th>
                    <th>Date & Time</th>
                </tr>
            </thead>
            <tbody>
                {% for r in records %}
                <tr>
                    <td>{{ r.heart_rate|default:"--" }}</td>
                    <td>{{ r.blood_pressure|default:"--" }}</td>
                    <td>{{ r.sugar_level|default:"--" }}</td>
                    <td>{{ r.temperature|default:"--" }}</td>
                    <td>{{ r.updated_at|date:"d M Y H:i" }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" class="text-center text-muted">
                        No health records found
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>


<!-- ADD RECORD SECTION -->


<div class="table-section">
    <h5 class="fw-bold mb-4 text-center">Add New Health Record</h5>

    <div class="row align-items-center g-4">

        <!-- LEFT SIDE IMAGE -->
        <div class="col-lg-5 text-center">
            <img src="/static/images/pic17.jpg"
                 alt="Health Record"
                 class="img-fluid rounded-4 shadow"
                 style="max-height: 320px;">
            <p class="text-muted mt-3">
                Accurate patient health data ensures better diagnosis and care.
            </p>
        </div>

        <!-- RIGHT SIDE FORM -->
        <div class="col-lg-7">
            <form method="POST">
                {% csrf_token %}

                <div class="row g-3">
                    {% for field in form %}
                    <div class="col-md-6">
                        <label class="fw-semibold mb-1">
                            {{ field.label }}
                        </label>
                        {{ field }}
                        {% if field.errors %}
                            <div class="text-danger small">
                                {{ field.errors|striptags }}
                            </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>

                <!-- BUTTONS -->
                <div class="d-flex justify-content-end gap-3 mt-4">

                    <!-- PDF BUTTON -->
                  <a href="{% url 'patient_pdf' patient.id %}"
                    class="btn btn-outline-danger px-4 py-2 fw-bold">
                    <i class="bi bi-file-earmark-pdf"></i> Download PDF
                    </a>

                    <!-- SAVE BUTTON -->
                    <button type="submit"
                            class="btn btn-success px-5 py-2 fw-bold">
                        ➕ Save Record
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>




{% endblock %}
