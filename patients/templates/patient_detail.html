{% extends "base.html" %}
{% block content %}

<style>
:root {
    --primary: #0aa6b7;
    --danger: #dc3545;
    --success: #28a745;
    --glass: rgba(255,255,255,0.95);
    --neutral: #f5f5f5;
}

/* General Section Card */
.section-card {
    background: var(--glass);
    border-radius: 18px;
    padding: 25px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.12);
    margin-bottom: 25px;
}

/* Header */
.profile-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

/* Status Pill */
.status-pill {
    padding: 6px 16px;
    border-radius: 50px;
    font-weight: 700;
    font-size: 14px;
}
.status-critical { background: #ffe5e5; color: var(--danger); }
.status-stable { background: #e9fff2; color: var(--success); }

/* Tabs */
.tab-btn {
    border: none;
    background: var(--neutral);
    padding: 10px 20px;
    border-radius: 12px;
    font-weight: 600;
    margin-right: 10px;
    cursor: pointer;
    transition: 0.3s;
}
.tab-btn.active {
    background: var(--primary);
    color: #fff;
}

/* Vitals Boxes */
.vital-box {
    padding: 20px;
    border-radius: 14px;
    text-align: center;
    border: 2px solid #eee;
    transition: 0.3s;
}
.vital-danger { border-color: var(--danger); background: #ffecec; }
.vital-safe { border-color: var(--success); background: #eafff1; }
.vital-title { font-weight: 600; margin-bottom: 8px; font-size: 16px; }
.vital-value { font-size: 1.5rem; font-weight: 700; }

/* Table */
.table th, .table td {
    vertical-align: middle !important;
}
.table th {
    background-color: var(--primary);
    color: #fff;
}
</style>

<!-- HEADER -->
<div class="profile-header">
    <h2 class="fw-bold">{{ patient.name }} ‚Äì Profile</h2>
    <a href="{% url 'patient_list' %}" class="btn btn-outline-secondary btn-sm">‚¨Ö Back</a>
</div>

<!-- STATUS SUMMARY -->
<div class="section-card d-flex justify-content-between align-items-center flex-wrap">
    <div>
        <h5 class="fw-bold mb-1">Patient Summary</h5>
        <p class="mb-1">Age: {{ patient.age }} | Gender: {{ patient.gender }}</p>
        <p class="mb-0 text-muted">Total Records: {{ records|length }}</p>
    </div>
    {% if records.last.heart_rate and records.last.heart_rate > 100 %}
        <span class="status-pill status-critical mt-2 mt-md-0">üî¥ Critical</span>
    {% else %}
        <span class="status-pill status-stable mt-2 mt-md-0">üü¢ Stable</span>
    {% endif %}
</div>

<!-- TABS -->
<div class="mb-3 d-flex flex-wrap">
    <button class="tab-btn active">Overview</button>
    <button class="tab-btn">Vitals</button>
    <button class="tab-btn">Add Record</button>
    <button class="tab-btn">Alerts</button>
</div>

<!-- OVERVIEW -->
<div class="section-card">
    <h5 class="fw-bold mb-3">Latest Vitals Snapshot</h5>
    <div class="row g-3">
        <!-- Heart Rate -->
        <div class="col-md-3 col-sm-6">
            <div class="vital-box {% if records.last.heart_rate and records.last.heart_rate > 100 %}vital-danger{% else %}vital-safe{% endif %}">
                <div class="vital-title">‚ù§Ô∏è Heart Rate</div>
                <div class="vital-value">{{ records.last.heart_rate|default:"--" }} bpm</div>
            </div>
        </div>
        <!-- Blood Pressure -->
        <div class="col-md-3 col-sm-6">
            <div class="vital-box vital-safe">
                <div class="vital-title">ü©∏ Blood Pressure</div>
                <div class="vital-value">{{ records.last.blood_pressure|default:"--" }}</div>
            </div>
        </div>
        <!-- Sugar -->
        <div class="col-md-3 col-sm-6">
            <div class="vital-box {% if records.last.sugar_level and records.last.sugar_level > 180 %}vital-danger{% else %}vital-safe{% endif %}">
                <div class="vital-title">üç¨ Sugar</div>
                <div class="vital-value">{{ records.last.sugar_level|default:"--" }} mg/dL</div>
            </div>
        </div>
        <!-- Temperature -->
        <div class="col-md-3 col-sm-6">
            <div class="vital-box vital-safe">
                <div class="vital-title">üå° Temperature</div>
                <div class="vital-value">{{ records.last.temperature|default:"--" }} ¬∞C</div>
            </div>
        </div>
    </div>
</div>

<!-- VITALS HISTORY -->
<div class="section-card">
    <h5 class="fw-bold mb-3">Vitals History</h5>
    <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
            <thead>
                <tr>
                    <th>HR</th>
                    <th>BP</th>
                    <th>Sugar</th>
                    <th>Temp</th>
                    <th>Date</th>
                </tr>
            </thead>
            <tbody>
                {% for r in records %}
                <tr>
                    <td>{{ r.heart_rate|default:"--" }}</td>
                    <td>{{ r.blood_pressure|default:"--" }}</td>
                    <td>{{ r.sugar_level|default:"--" }}</td>
                    <td>{{ r.temperature|default:"--" }}</td>
                    <td>{{ r.updated_at|date:"d M Y H:i" }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" class="text-center">No records available</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- ADD RECORD -->
<div class="section-card">
    <h5 class="fw-bold mb-3">Add New Health Record</h5>
    <form method="POST" class="row g-3">
        {% csrf_token %}
        {{ form.as_p }}
        <div class="text-center">
            <button class="btn btn-success px-4">‚ûï Save Record</button>
        </div>
    </form>
</div>

{% endblock %}
